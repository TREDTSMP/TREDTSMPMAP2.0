<!DOCTYPE html>
<html>
<head>
    <title>uNmINeD</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    
    <!-- OpenLayers  -->
    <link rel="stylesheet" type="text/css" href="lib/ol.css">
    <script src="lib/ol.js"></script>
    
    <!-- OpenLayers Context Menu -->
    <link href="lib/ol-contextmenu.css" rel="stylesheet">
    <script src="lib/ol-contextmenu.iife.js"></script>
    
    <!-- Toastify -->
    <script type="text/javascript" src="lib/toastify-js"></script>
    <link rel="stylesheet" type="text/css" href="lib/toastify.min.css">

    <!-- Map metadata generated by uNmINeD -->
    <script type="text/javascript" src="unmined.map.properties.js"></script>
    <script type="text/javascript" src="unmined.map.regions.js"></script>
    <script type="text/javascript" src="unmined.map.players.js"></script>
    
    <!-- Custom markers -->
    <script type="text/javascript" src="custom.markers.js"></script>
    
    <!-- uNmINeD JS and CSS -->
    <script type="text/javascript" src="unmined.js"></script>
    <link rel="stylesheet" type="text/css" href="index.css">
    
    <style>
        /* Loading Screen Styles */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .loading-container {
            width: 400px;
            padding: 30px;
            background: #0a1a3f;
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
            text-align: center;
            transition: opacity 1s ease;
        }

        .loading-title {
            color: #00ffff;
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.7);
        }

        .loading-circle {
            width: 80px;
            height: 80px;
            border: 5px solid rgba(0, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #00ffff;
            animation: spin 1.5s linear infinite;
            margin: 0 auto 2rem;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }

        .loading-bar-container {
            width: 100%;
            height: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            margin-bottom: 1.5rem;
        }

        .loading-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #0080ff, #00ffff, #0080ff);
            border-radius: 15px;
            position: relative;
            transition: width 0.05s linear;
        }

        .loading-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(0, 255, 255, 0.4),
                transparent
            );
            animation: shimmer 2s infinite;
        }

        .loading-progress {
            color: #00ffff;
            font-size: 1.2rem;
            margin-bottom: 1rem;
        }

        /* Welcome Message Styles */
        .welcome-message {
    opacity: 0;
    text-align: center;
    transition: opacity 2s ease;
    margin-top: 2rem;
}

        .welcome-title {
            color: #00ffff;
            font-size: 2.5rem;
            margin-bottom: 1rem;
            text-shadow: 0 0 15px rgba(0, 255, 255, 0.7);
        }

        .welcome-subtitle {
            color: #4db8ff;
            font-size: 1.5rem;
            margin-bottom: 0;
            text-shadow: 0 0 10px rgba(77, 184, 255, 0.7);
        }

        /* Animations */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Hide map initially */
        #map {
            display: none;
        }
		.center-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}
    </style>
</head>
<body>
    <div id="loading-screen" class="loading-screen">
    <div class="center-container">
        <div class="loading-container" id="loading-container">
            <div class="loading-title">Loading Resources</div>
            <div class="loading-circle"></div>
            <div class="loading-bar-container">
                <div class="loading-bar" id="loading-bar"></div>
            </div>
            <div class="loading-progress" id="loading-progress">1%</div>
        </div>

        <div class="welcome-message" id="welcome-message">
            <h1 class="welcome-title">Welcome to the TREDT SMP Map</h1>
            <p class="welcome-subtitle">2D with 3D Effects and Shadows</p>
        </div>
    </div>
</div>

    <!-- Map Container -->
    <div id="map"></div>

    <script type="text/javascript">
        // Loading screen functionality
        const loadingScreen = document.getElementById('loading-screen');
        const loadingContainer = document.getElementById('loading-container');
        const loadingBar = document.getElementById('loading-bar');
        const loadingProgress = document.getElementById('loading-progress');
        const welcomeMessage = document.getElementById('welcome-message');
        
        // Timing constants
        const LOADING_DURATION = 10000;   // 10 seconds
        const INTRO_DURATION = 2000;      // 2 seconds
        const OUTRO_DURATION = 1000;      // 1 second
        const TOTAL_DURATION = LOADING_DURATION + INTRO_DURATION + OUTRO_DURATION; // 13 seconds
        
        // Initialize loading sequence
        function startLoading() {
            let progress = 1;
            const loadingInterval = setInterval(() => {
                progress += 1;
                loadingBar.style.width = `${progress}%`;
                loadingProgress.textContent = `${progress}%`;
                
                if (progress >= 100) {
                    clearInterval(loadingInterval);
                    setTimeout(showWelcomeMessage, LOADING_DURATION);
                }
            }, LOADING_DURATION / 100); // 100ms per percent = 10 seconds total loading
        }
        
        function showWelcomeMessage() {
            // Hide loading container
            loadingContainer.style.opacity = '0';
            
            // Show welcome message with fade in
            setTimeout(() => {
                loadingContainer.style.display = 'none';
                welcomeMessage.style.opacity = '1';
                
                // After welcome message, start outro
                setTimeout(startOutro, INTRO_DURATION);
            }, 500);
        }
        
        function startOutro() {
            // Fade out everything
            loadingScreen.style.opacity = '0';
            
            // Show map after outro
            setTimeout(() => {
                loadingScreen.style.display = 'none';
                initMap(); // Initialize map after loading screen
            }, OUTRO_DURATION);
        }
        
        // Start loading immediately
        startLoading();
        
        // Map initialization function
        function initMap() {
            document.getElementById('map').style.display = 'block';
            document.title = UnminedMapProperties.worldName + " - " + document.title;
            
            if (UnminedCustomMarkers && UnminedCustomMarkers.isEnabled && UnminedCustomMarkers.markers) {
                UnminedMapProperties.markers = UnminedMapProperties.markers.concat(UnminedCustomMarkers.markers);
            }
            
            if (UnminedPlayers && UnminedPlayers.length > 0) {
                UnminedMapProperties.playerMarkers = Unmined.createPlayerMarkers(UnminedPlayers);
            }
            
            const mapElement = document.getElementById('map');
            const unmined = new Unmined(mapElement, UnminedMapProperties, UnminedRegions);
        }
    </script>
	<script>
    const mapElement = document.getElementById('map');

    document.title = UnminedMapProperties.worldName + " - TREDT SMP";
    UnminedMapProperties.markerDisplay = { minZoom: 0, maxZoom: 28 };

    if (UnminedCustomMarkers?.isEnabled && UnminedCustomMarkers.markers) {
        UnminedMapProperties.markers = [
            ...(UnminedMapProperties.markers || []),
            ...UnminedCustomMarkers.markers
        ];
    }

    if (UnminedPlayers?.length > 0) {
        UnminedMapProperties.playerMarkers = Unmined.createPlayerMarkers(UnminedPlayers);
    }

    const unmined = new Unmined(mapElement, UnminedMapProperties, UnminedRegions);

    // NEW BEHAVIOR: When clicking a marker, open a new tab
    mapElement.addEventListener('click', function (e) {
        const marker = e.target.closest('.unmined-marker');
        if (!marker) return;

        const markerText = marker.title || marker.textContent;
        const folderName = markerText.replace(/\s+/g, '_'); // Replace spaces with underscores

        // Redirect to images/PlaceName/index.html in a new tab
        const url = `images/${folderName}/index.html`;
        window.open(url, '_blank');
    });
</script>
</body>
</html>